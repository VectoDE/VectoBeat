name: üõ°Ô∏è Quality Gate

on:
  push:
    branches:
      - main
      - developement
  pull_request:
    branches:
      - main
      - developement

jobs:
  frontend-lint:
    runs-on: ubuntu-latest
    env:
      NEXT_TELEMETRY_DISABLED: "1"
      DATABASE_URL: "mysql://user:password@localhost:3306/vectobeat"
      CI: "true"
    defaults:
      run:
        working-directory: frontend
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: Run frontend lint
        uses: ./.github/actions/test-runner
        with:
          test-type: frontend-lint
          working-directory: frontend

  frontend-test:
    runs-on: ubuntu-latest
    env:
      NEXT_TELEMETRY_DISABLED: "1"
      DATABASE_URL: "mysql://user:password@localhost:3306/vectobeat"
      CI: "true"
    defaults:
      run:
        working-directory: frontend
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: Run frontend tests
        uses: ./.github/actions/test-runner
        with:
          test-type: frontend-test
          working-directory: frontend

  bot-compile:
    runs-on: ubuntu-latest
    env:
      PYTHONPATH: ${{ github.workspace }}/bot
      PYTEST_ADDOPTS: "--capture=no --maxfail=1"
    defaults:
      run:
        working-directory: bot
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: Run Python compilation check
        uses: ./.github/actions/test-runner
        with:
          test-type: python-compile
          working-directory: bot

  bot-test:
    runs-on: ubuntu-latest
    env:
      PYTHONPATH: ${{ github.workspace }}/bot
      PYTEST_ADDOPTS: "--capture=no --maxfail=1"
    defaults:
      run:
        working-directory: bot
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: Run Python tests
        uses: ./.github/actions/test-runner
        with:
          test-type: python-test
          working-directory: bot